{% extends 'master.html' %} {% load static %} {% block title %} Transaction
History {% endblock %} {% block content %}

<div class="container py-4">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2 class="mb-0">Transaction History</h2>
      <span class="badge bg-primary fs-6">
        Current Balance: Ksh{{ current_balance|floatformat:2 }}
      </span>
    </div>

    <div class="card-body">
      <!-- Transaction Table -->
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th>Reference</th>
              <th>Type</th>
              <th class="text-end">Amount (Ksh)</th>
              <th>Processed By</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {% for transaction in transactions %}
            <tr
              class="{% if transaction.transaction_type == 'DEP' %}table-success{% else %}table-danger{% endif %}"
            >
              <td>{{ transaction.transaction_date|date:"M d, Y H:i" }}</td>
              <td>{{ transaction.reference_number }}</td>
              <td>
                <span
                  class="badge {% if transaction.transaction_type == 'DEP' %}bg-success{% else %}bg-danger{% endif %}"
                >
                  {{ transaction.get_transaction_type_display }}
                </span>
              </td>
              <td class="text-end">{{ transaction.amount|floatformat:2 }}</td>
              <td>
                {{
                transaction.processed_by.get_full_name|default:transaction.processed_by.username
                }}
              </td>
              <td>{{ transaction.description|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-4">
                No transactions found
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if transactions.has_other_pages %}
      <nav aria-label="Transaction pagination">
        <ul class="pagination justify-content-center">
          {% if transactions.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page=1" aria-label="First">
              <span aria-hidden="true">&laquo;&laquo;</span>
            </a>
          </li>
          <li class="page-item">
            <a
              class="page-link"
              href="?page={{ transactions.previous_page_number }}"
              aria-label="Previous"
            >
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          {% endif %} {% for num in transactions.paginator.page_range %} {% if
          transactions.number == num %}
          <li class="page-item active">
            <span class="page-link">{{ num }}</span>
          </li>
          {% elif num > transactions.number|add:'-3' and num <
          transactions.number|add:'3' %}
          <li class="page-item">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
          </li>
          {% endif %} {% endfor %} {% if transactions.has_next %}
          <li class="page-item">
            <a
              class="page-link"
              href="?page={{ transactions.next_page_number }}"
              aria-label="Next"
            >
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
          <li class="page-item">
            <a
              class="page-link"
              href="?page={{ transactions.paginator.num_pages }}"
              aria-label="Last"
            >
              <span aria-hidden="true">&raquo;&raquo;</span>
            </a>
          </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}

      <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
        <a
          href="{% url 'accounts:account_detail' account.id %}"
          class="btn btn-secondary"
        >
          <i class="bi bi-arrow-left"></i> Back to Account
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
